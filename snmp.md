# SNMP
SNMP message = header + PDU (protocol data unit)
* header has SNMP version + a community string 
  
v1 and v2 use commnuity string; no encryption. v3 uses username and password, with encryption. 

Usually, "public" community string gives read-only access; "private" community string gives read and write access. 

**SNMP attacks**
- flooding: DOS attack, spoof SNMP agent and flood the SNMP trap management 
- community: using default community strings to gain privileged access to systems
- brute force community strings to achieve elevated privileges

### Scanning
```
$ sudo nmap -sU -p 161 <ip>
```  

### brute force community string
```
$ sudo nmap -sU -p 161 --script=snmp-brute <ip>
```
* default dictionary used: `$ find -name snmpcommunities.lst `

Can also use a more extensive dictionary in seclists:
```
$ nmap -sU -p 161 --script=snmp-brute <ip> --script-args snmp-brute.communitiesdb='/usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt'
```

### Enumeration (win32)

User accounts:
```
$ sudo nmap -sU -p 161 --script snmp-win32-users <ip>
```
* this is the same as `$ snmpwalk -v 2c <snmp-server> -c <community-string> 1.3.6.1.4.1.77.1.2.25`

Services:
```
$ sudo nmap -sU -p 161 --script snmp-win32-services <ip>
```

Software:
```
$ sudo nmap -sU -p 161 --script snmp-win32-software <ip>
```

Run all snmp related NSE scripts:
```
$ sudo nmap -sU -p 161 --script snmp-* <ip> > output.txt
```

Lookup available scripts [here](https://www.infosecmatter.com/ultimate-list-of-nmap-nse-scripts-interactive-table/)

For Linux, see `snmp-check`

### snmpwalk & snmpset

Walk:
```
$ snmpwalk -v 2c <ip> -c <c-string> <OID>
```
* snmp version: 2c
* community string: public

Update MIB record (e.g. updating an example): 
```
$ snmpset -v 2c <ip> -c <c-string> <OID> s newemail@example.com
```
* s is string (need to specify the new data type when updating) 

