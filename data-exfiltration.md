# Data Exfiltration

## Setup
![Screenshot_2021-05-01_18-19-45](https://user-images.githubusercontent.com/39619599/116796521-172eba80-aaab-11eb-9a8e-122dd7b59ee8.png)

Windows workstation has no internet connectivity

### Task 1: Connect to and scrutinize the 172.16.91.100 machine

```
# RDP connection
rdesktop 172.16.91.100
```

```
# search file systems for sensitive files to exfiltrate
# first go to the root directory
dir /
dir /s /b passwords*
dir /s /b credentials*
```
* /s - Goes thru the subdirectories as well
* /b - Displays a bare list of directories and files, with no additional information. 

![1](https://user-images.githubusercontent.com/39619599/116796517-1007ac80-aaab-11eb-9b93-52f923b94b76.png)

Additionally, discovered that Python is installed on the victim `Python --version`

### Task 2: Identify if the 172.16.91.100 machine allows any of the commonly used ports outbound connectivity
Check ports 80 (TCP), 443 (TCP), 8080 (TCP), 8443 (TCP), and 53 (UDP)

!!! can directly check Windwos firewall config !!! or

Strategy for TCP ports: deploye a Python SimpleHTTPServer on Kali on various port and check if we can establish connection from the victim's browser to those ports on Kali (i.e. 172.16.91.10:8080). Find a port that the victim's firewall allows outbound connectivity to and use this to pass files to victim. 

```
# -m run as a module
python -m SimpleHTTPServer 8080
```

Strategy for port 53: If Kali is in the same broadcast domain, just sniff with WireShark (in promiscuous mode) to see if there's any DNS packet. Since we're using RDP here, the work around is to set the DNS server on the victim to Kali and try to open any webpage to see if there's any DNS packet coming thru. 

On Windows, go Ethernet0 -> Properties -> Internet Protocol Version 4 -> Properties

<img src="https://user-images.githubusercontent.com/39619599/116796838-aa68ef80-aaad-11eb-9940-d6b91b09967e.png" width=40%>

### Task 3: Exfiltrate a file with PacketWhisper

Need PacketWhisper on both Kali and victim

On Kali

```
git clone https://github.com/TryCatchHCF/PacketWhisper.git
```

For victim, pass the zipped version over via the web server
```
# download as zip file
wget https://github.com/TryCatchHCF/PacketWhisper/archive/master.zip
```
See lab notes for details (this is in pre-req)

### Task 4: Identify another port that allow outbound connection to by automated enumeration with egresscheck framework

repo: https://github.com/stufus/egresscheck-framework

See lab notes for details

The identified port is 9000. It's highlighted in darkred in WireShark because it's a TCP RST (reset), which means the victim tries to establish a connection (SYN) with Kali on a port where there's no service listening to, so Kali says, RESET TCP. 
![dd](https://user-images.githubusercontent.com/39619599/116797026-3a5b6900-aaaf-11eb-96ce-8c6734f566bd.png)

