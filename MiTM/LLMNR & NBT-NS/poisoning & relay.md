# LLMNR/NBT-NS Poisoning & Relay
Tool: Responder & MultiRelay

LLMNR and NBT-NS are fall-back protocols of DNS. Responder listens for NetBIOS and LLMNR broadcast and multicast requests for hostnames from other machines in the local subnet, and responds to them. 

From there, we can use MultiRelay to relay the authentication to the legitimate server. MultiRelay tool spins up a shell by default (and you can privilege escalate from there); if `-d` flag is used, it dumps the local password hashes. 

# Why it works 

## Poisoning
Common causes LLMNR/NBT-NS is used on the LAN that allow an attacker to resolve to a non-existent hostname include: 
- typo in hostname
- misconfiguration on the DNS server side or client side
- decommissioned DNS records
- Google Chrome attempting to [resolve three randomized domain names at start up](https://unix.stackexchange.com/questions/363512/chrome-dns-requests-with-random-dns-names-malware) to avoid [DNS hijacking by the ISP](https://en.wikipedia.org/wiki/DNS_hijacking#Manipulation_by_ISPs)
    <img src=“https://www.sikich.com/wp-content/uploads/2019/06/multirelay.png”>
- WPAD (Web Proxy Auto-Discovery Protocol): if a web browser is set to automatically detect proxy settings, it will use the WPAD protocol to discover the URL of a proxy configuration file called _wpad.dat_. To discover this URL, WPAD will iterate through a series of potential URLs and hostnames. Google Chrome and Firefox will not trigger this behavior by default, but Internet Explorer will.

## Relay
GOOD article: https://en.hackndo.com/ntlm-relay/#ntlm-relay 

For SMB relay to work, SMB signing must be disabled in the victim and SMB server.  

# Tool: Responder & MultiRelay

Check SMB signing with `RunFinger.py`
```
$ sudo ./tools/RunFinger.py -i <target-ip-or-netblock>
```

If we're going to relay with `MultiRelay.py` **while running `responder.py`, we need to disable the SMB server and HTTP server in `Responder.conf`, because `MultiRelay.py` need to use these ports to relay. If we're only poisoning to obtain hashes to crack offline, leave config at default. 

TO BE UPDATED!!! 




