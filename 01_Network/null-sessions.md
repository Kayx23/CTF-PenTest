# Null Session

A null session occurs when you connect to a share with null credentials. 
* Windows __Inter-Process Communication share__ ([IPC$ share](https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/inter-process-communication-share-null-session#about-ipc-share))

## nmap
```
$ nmap --script smb-enum-shares <ip> -p 445 
```

## enum4linux

Enumerate shares
```
enum4linux -U 192.168.99.162
```

Enumerate user list
```
enum4linux -U 192.168.99.162
```

## smbmap
Automated tool to map share access. 

To map with empty username and password: 
```
$ smbmap -H 192.168.99.162 
[+] IP: 192.168.99.162:445      Name: 192.168.99.162                                    
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        My Documents                                            READ, WRITE
        IPC$                                                    NO ACCESS       Remote IPC
        Frank                                                   NO ACCESS
        C                                                       READ, WRITE
        WorkSharing                                             READ, WRITE
        FrankDocs                                               NO ACCESS
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
```

We see that we can log into C, WorkSharing and My Documents with null credentials. 

To map with a given user name and password: 
```
$ smbmap -H 192.168.99.162 -u "username" -p "password"
```

## smbclient

**SMB Configuration**

In some distro (Kali 2021.1 included), you get an error `protocol negotiation failed: NT_STATUS_IO_TIMEOUT` when you run `smbclient`. 

To fix the issue, open `/etc/samba/smb.conf` and add the following config under `[global]`: 
```
client min protocol = CORE
client max protocol = SMB3
```

**See shares**
```
$ smbclient -L 192.168.99.162
        Sharename       Type      Comment
        ---------       ----      -------
        My Documents    Disk      
        IPC$            IPC       Remote IPC
        Frank           Disk      
        C               Disk      
        WorkSharing     Disk      
        FrankDocs       Disk      
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
```

**Connect to a share**

```
$ smbclient //192.168.99.162/C                
smb: \> ls
  AUTOEXEC.BAT                        A        0  Thu Feb 12 19:50:47 2015
  boot.ini                           HS      211  Thu Feb 12 19:46:17 2015
......
```

**Connect to $IPC**

```
$ smbclient //192.168.99.162/IPC$
```

**Download File**
```
get [filename]
```

<br> <br>

## Other Tools

### Check if File Server is running

See NetBIOS name table of the host; `<20>` means file server is running
```
$ nmblookup -A 192.168.99.162
Looking up status of 192.168.99.162
        ELS-WINXP       <00> -         B <ACTIVE> 
        WORKGROUP       <00> - <GROUP> B <ACTIVE> 
        ELS-WINXP       <20> -         B <ACTIVE> 
        WORKGROUP       <1e> - <GROUP> B <ACTIVE> 
        WORKGROUP       <1d> -         B <ACTIVE> 
        ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE> 
```

## Connecting from Windows

### Check if File Server is running

See NetBIOS name table of the host; `<20>` means file server is running
```
> nbtstat -A <ip address> 
```

See shares
```
> net view <ip address> 
```
