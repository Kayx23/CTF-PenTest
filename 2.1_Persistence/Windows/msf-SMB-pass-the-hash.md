# SMB Pass The Hash with PSExec

Pass the hash is pretty straightforward to use against SMB when 
* NTLM authentication is enabled on the SMB server
* `EnableSecuritySignature = 1` in `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanManServer\Parameters`
* One of the two scenarios: 
  * Passing the hash to log into the built-in administrator account (RID 500 User) and `FilterAdministratorToken = 0` in the registry, under `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System` - which allows the RID 500 user to do **remote** administrative tasks(aka no UAC)
  * Passing the hash to log into a local admin account (i.e. a non RID 500 user) and `LocalAccountTokenFilterPolicy = 1` in the registry, under `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System` - which allows all accounts in the “Administrators” group to do remote administration tasks
    ```
    > reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 0 /f
    ```

### How to pass the hash
```
> use exploit/windows/smb/psexec
```

If you know the username and password, set `SMBUser` and `SMBPass`. 

If you know the LM:NTLM hash, pass that to `SMBPass`
* [see example](https://www.offensive-security.com/metasploit-unleashed/psexec-pass-hash/)