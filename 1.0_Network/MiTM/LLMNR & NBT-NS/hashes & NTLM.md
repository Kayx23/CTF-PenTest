# LM Hash, NTHash; NTLMv1, NTLMv2
Summarized from https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4

Covers two protocol types:
* NTLMv1
* NTLMv2

and two hash types: 
* LM Hash
* NT Hash

The hash types not only are used in NTLM protocols, but also used in hashing user password locally on windows systems. The hashes, when available, can be obtained from either
* SAM databases; or
* NTDS database from the domain controller

### LM Hash
LM-hashes is the oldest password storage used by windows (from 1980s)
* only allow limited charset, so fairly easy to crack
* turned off by default starting in Windows Vista/server 2008, but it is possible to re-enable them through GPO

Format: 
```
299BD128C1101FD6
```

LM Hashing Algorithm:
```
1. Convert all lower case to upper case
2. Pad password to 14 characters with NULL characters
3. Split the password to two 7 character chunks
4. Create two DES keys from each 7 character chunk
5. DES encrypt the string "KGS!@#$%" with these two chunks
6. Concatenate the two DES encrypted strings. This is the LM hash.
```

Cracking: 
```
$ john --format=lm hash.txt
$ hashcat -m 3000 -a 3 hash.txt
```

### NT Hash

Example
```
B4B9B02E6F09A9BD760F388B67351E2B
```
The algorithm
```
MD4(UTF-16-LE(password))
```

Cracking
```
$ john --format=nt hash.txt
$ hashcat -m 1000 -a 3 hash.txt
```

### NTLMv1 (or Net-NTLMv1)
* The NTLM protocol uses the NT Hash (or LM hash, depending on the config) in a challenge/response between a server and a client. 
> > The LM hash is stored for backward compatibility reasons. Many environments no longer need it and can disable storage of that value.

Example
```
u4-netntlm::kNS:338d08f8e26de93300000000000000000000000000000000:9526fb8c23a90751cdd619b6cea564742e1e4bf33006ba41:cb8086049ec4736c
```

The algorithm
```
C = 8-byte server challenge, random
K1 | K2 | K3 = LM/NT-hash | 5-bytes-0
response = DES(K1,C) | DES(K2,C) | DES(K3,C)
```

Cracking
```
$ john --format=netntlm hash.txt
$ hashcat -m 5500 -a 3 hash.txt
```

### NTLMv2 (or Net-NTLMv2)
* newer and improved. Default in Windows since Windows 2000.
* The concept is the same as NTLMv1; the major difference is the algo used is changed from DES to HMAC-MD5

example
```
admin::N46iSNekpT:08ca45b7d7ea58ee:88dcbe4446168966a153a0064958dac6:5c7830315c7830310000000000000b45c67103d07d7b95acd12ffa11230e0000000052920b85f78d013c31cdb3b92f5d765c783030
```

The algorithm
```
SC = 8-byte server challenge, random
CC = 8-byte client challenge, random
CC* = (X, time, CC2, domain name)
v2-Hash = HMAC-MD5(NT-Hash, user name, domain name)
LMv2 = HMAC-MD5(v2-Hash, SC, CC)
NTv2 = HMAC-MD5(v2-Hash, SC, CC*)
response = LMv2 | CC | NTv2 | CC*
```

Cracking
```
$ john --format=netntlmv2 hash.txt
$ hashcat -m 5600 -a 3 hash.txt
```